#!/bin/bash

# claude-clear - Clear all outputs to start fresh

echo "ğŸ§¹ Claude SOP Generator - Clear Outputs"
echo "====================================="
echo ""

# Check if output directory exists
if [ ! -d "output" ]; then
    echo "âœ… Output directory doesn't exist - nothing to clear"
    exit 0
fi

# Check what exists to clear
FOUND_OUTPUTS=false
if [ -d "output/stage1-define" ]; then
    FOUND_OUTPUTS=true
    echo "ğŸ“ Found Stage 1 outputs"
fi
if [ -d "output/stage2-design" ]; then
    FOUND_OUTPUTS=true
    echo "ğŸ“ Found Stage 2 outputs"
fi
if [ -d "output/stage3-build" ]; then
    FOUND_OUTPUTS=true
    echo "ğŸ“ Found Stage 3 outputs"
fi
if [ -f "output/overall-review.md" ]; then
    FOUND_OUTPUTS=true
    echo "ğŸ“„ Found overall review"
fi

if [ "$FOUND_OUTPUTS" = false ]; then
    echo "âœ… No outputs found - nothing to clear"
    exit 0
fi

echo ""
echo "âš ï¸  WARNING: This will delete all generated outputs!"
echo "   You will lose all SOPs, prompts, and implementation files."
echo ""
read -p "Are you sure you want to continue? (yes/no): " confirmation

if [ "$confirmation" != "yes" ]; then
    echo ""
    echo "âŒ Clear operation cancelled"
    exit 0
fi

echo ""
echo "ğŸ—‘ï¸  Clearing outputs..."

# Remove all stage outputs
if [ -d "output/stage1-define" ]; then
    rm -rf output/stage1-define
    echo "âœ… Cleared Stage 1 outputs"
fi

if [ -d "output/stage2-design" ]; then
    rm -rf output/stage2-design
    echo "âœ… Cleared Stage 2 outputs"
fi

if [ -d "output/stage3-build" ]; then
    rm -rf output/stage3-build
    echo "âœ… Cleared Stage 3 outputs"
fi

if [ -f "output/overall-review.md" ]; then
    rm -f output/overall-review.md
    echo "âœ… Cleared overall review"
fi

# Check if output directory is empty and remove if so
if [ -z "$(ls -A output 2>/dev/null)" ]; then
    rmdir output
fi

echo ""
echo "âœ¨ All outputs cleared successfully!"
echo ""
echo "You can now start fresh with a new use case:"
echo "1. Create or update input/use-case.md"
echo "2. Run ./claude-define to begin"
echo ""

# Optional: Ask if they want to clear the input as well
if [ -f "input/use-case.md" ]; then
    echo "ğŸ’¡ Tip: Your current use case is still in input/use-case.md"
    read -p "   Would you like to clear the input file too? (yes/no): " clear_input
    
    if [ "$clear_input" = "yes" ]; then
        rm -f input/use-case.md
        echo "âœ… Input file cleared"
        echo ""
        echo "ğŸ“ Create a new input/use-case.md to get started"
    fi
fi